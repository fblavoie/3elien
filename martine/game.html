<html lang="fr" xml:lang="fr" xmlns="http://www.w3.org/1999/xhtml">

<!--

Copyrights : Francis B. Lavoie et Adam Renquinha. TOUS DROITS RÉSERVÉS

-->

	<head>
		<meta charset="UTF-8">
		<script
		  src="https://code.jquery.com/jquery-3.6.0.min.js"
		  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
		  crossorigin="anonymous"></script>
		 <script
		  src="https://code.jquery.com/ui/1.13.1/jquery-ui.min.js"
		  integrity="sha256-eTyxS0rkjpLEo16uXTS0uVCS4815lc40K2iVpWDvdSY="
		  crossorigin="anonymous"></script>
		  <link rel="preconnect" href="https://fonts.googleapis.com">
		  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
		  
		  <style>
		  
			body{
				background: url("assets/img/decor.png");
				background-repeat: no-repeat;
				background-size: 100vw 100vh;
			}

			.vehicule {
				cursor:pointer;
			}

			div{
				user-drag:none;
				user-select:none;
				-moz-user-select:none;
				-webkit-user-drag:none;
				-websit-user-select:none;
				-ms-user-select:none;
			}

			img{
				user-drag:none;
				user-select:none;
				-moz-user-select:none;
				-webkit-user-drag:none;
				-websit-user-select:none;
				-ms-user-select:none;
			}
		  
		  </style>
	</head>
	
	<body id="bodygame" style="  overflow: hidden; width:100%;">
	
		<div id="princ_container" style="width:100%;height: auto;aspect-ratio: 16/9;">

			
			
			<span id="vehicules_container">
				
				<img id="tramway1" src="assets/img/vehicules/tramway.png" style="width:4vw;height:auto;left:15.5vw;top:-38.5vh;position:absolute;">
				<img id="tramway2" src="assets/img/vehicules/tramway.png" style="width:4vw;height:auto;left:32.5vw;top:100vh;position:absolute;">
				<img id="tramway3" src="assets/img/vehicules/tramway.png" style="width:4vw;height:auto;left:49.5vw;top:-38.5vh;position:absolute;">
				<img id="tramway4" src="assets/img/vehicules/tramway.png" style="width:4vw;height:auto;left:54.9vw;top:100vh;position:absolute;">
				<img id="tramway5" src="assets/img/vehicules/tramway.png" style="width:4vw;height:auto;left:70.7vw;top:-38.5vh;position:absolute;">
				<img id="tramway6" src="assets/img/vehicules/tramway.png" style="width:4vw;height:auto;left:83.9vw;top:100vh;position:absolute;">
				<img id="martinecarimage" src="assets/img/vehicules/martinecar.png" style="width:9vw;height:auto;left:-3vw;top:41vh;position:absolute;">

			</span>
			
			<span id="reload_button" style="display:none;">
				<div  onclick="restart();" class="vehicule" style="background-color:#eef52a;top:47.5vh;left:40vw;padding:5px;position:absolute;height:5vh;font-size:5vh;color:black;border: solid 1px black;font-family: Arial, Helvetica, sans-serif;" ><b>RECOMMENCER</b></div>
				<div  onclick="window.open('https://tripli.ca/3elien/', '_blank').focus();" class="vehicule" style="background-color:#eef52a;top:10.5vh;left:20vw;padding:5px;position:absolute;height:5vh;font-size:5vh;color:black;border: solid 1px black;font-family: Arial, Helvetica, sans-serif;display:none;" ><b>Jouez à notre grand classique: 3e lien, LE JEU.</b></div>
			</span>
			
			<div id="button_action" class="vehicule" style="font-family: Arial, Helvetica, sans-serif;;top:85vh;left:67vw;height:10vh;width:30vw;text-align:center;position:absolute;background:#d0eb05;font-size:8vh;padding-top:1vh;border: solid 1px black;" onclick="change_action()" >AVANCER</div>
			
			<script>
			
					
					function restart(){
						$("#button_action").show();
						$("#reload_button").hide();
						gameover = false;
						moving = false;
						$("#martinecarimage").css("left","-3vw");
						$("#martinecarimage").css("top","41vh");
						$("#button_action").html("AVANCER");
						carstart.pause();
						carstart.currentTime = 0;
						carstart.play();
					}
			
					// 
					function tramway1(){
						$("#tramway1").animate({"top":"100vw"},5000,"linear",function(data){
							$("#tramway1").css("top","-38.5vh");
							setTimeout(function(){ tramway1(); },  Math.floor(Math.random() * 10)*100+1000);
						});
					}
					tramway1()
					
					function tramway2(){
						$("#tramway2").animate({"top":"-38.5vw"},4000,"linear",function(data){
							$("#tramway2").css("top","100vh");
							setTimeout(function(){ tramway2(); },  Math.floor(Math.random() * 10)*80+500);
						});
					}
					tramway2()
					
					function tramway3(){
						$("#tramway3").animate({"top":"100vw"},3000,"linear",function(data){
							$("#tramway3").css("top","-38.5vh");
							setTimeout(function(){ tramway3(); },  Math.floor(Math.random() * 10)*80+100);
						});
					}
					tramway3()
					
					function tramway4(){
						$("#tramway4").animate({"top":"-38.5vw"},2500,"linear",function(data){
							$("#tramway4").css("top","100vh");
							setTimeout(function(){ tramway4(); },  Math.floor(Math.random() * 10)*80+0);
						});
					}
					tramway4()	

					function tramway5(){
						$("#tramway5").animate({"top":"100vw"},2000,"linear",function(data){
							$("#tramway5").css("top","-38.5vh");
							setTimeout(function(){ tramway5(); },  Math.floor(Math.random() * 10)*100+20);
						});
					}
					tramway5()					
					
					function tramway6(){
						$("#tramway6").animate({"top":"-38.5vw"},1000,"linear",function(data){
							$("#tramway6").css("top","100vh");
							setTimeout(function(){ tramway6(); },  0);
						});
					}
					tramway6();	
					
					
					
					
					var moving = false;
			
					function move_car(){
						$("#martinecarimage").animate({"left":"+=0.2vw"},1,"linear",function(data){
							if( moving ){
								move_car();
							}
						});
					}
					
					var rot = 0
					function gameover_anim(){
						rot = rot + 5;
						$("#martinecarimage").css("transform","rotate(+"+rot+"deg)");
						setTimeout(function(){ 
							if(gameover){ gameover_anim(); }
							else{
								$("#martinecarimage").css("transform","rotate(+0deg)");
							} 
						},  10);
					}
					
					function change_action(){
						if( moving){
							moving = false;
							$("#button_action").html("AVANCER");
							jump1.pause();
							jump1.currentTime = 0;
							jump1.play();
						}
						else{
							moving = true;
							move_car();
							$("#button_action").html("FREINER");
							jump2.pause();
							jump2.currentTime = 0;
							jump2.play();
						}
					}
					
					
					
					
					function elementsOverlap(el1, el2) {
					  const domRect1 = el1.getBoundingClientRect();
					  const domRect2 = el2.getBoundingClientRect();

					  return !(
						domRect1.top > domRect2.bottom ||
						domRect1.right < domRect2.left ||
						domRect1.bottom < domRect2.top ||
						domRect1.left > domRect2.right
					  );
					}
					
					var gameover = false;
					
					function check_accident(){
						car = document.getElementById("martinecarimage");
						for(i=1;i<=6;i++){
							if( elementsOverlap(car, document.getElementById("tramway"+i)) ){
								console.log("HIT")
								moving = false;
								$("#button_action").hide();
								if(gameover == false){
								
									explosion.pause();
									explosion.currentTime = 0;
									explosion.play();
									
									failure.pause();
									failure.currentTime = 0;
									failure.play();
									
									gameover = true
									gameover_anim();
									setTimeout(function(){ 
										$("#martinecarimage").animate({"left":"-10vw","top":"25vh"},2500,"linear",function(data){
											$("#reload_button").show();
										});
									},  500);
								}
							}
						}
					}
					
					setInterval(function () {
						check_accident();
					}, 10);


			</script>
			
			<div id="type_vehicule_show" style="height:3vh;font-size:3vh;top:85vh;margin-left:1vh;position:absolute;color:white;"></div>
			<div id="mod_score_show" style="display:none;height:3vh;font-size:3vh;top:89vh;margin-left:1vh;position:absolute;color:white;"><span id="score_mod"></span> points</div>
		
		</div>

		<div id="final_container" style="display:none;width:100%;">
			
			<div style="top:48.5vh;margin:auto;left:20vw;position:absolute;height:5vh;font-size:5vh;color:white;font-family: 'Press Start 2P', cursive;"><b>SCORE FINAL: <span id="final_score"></span> points</b></div>
			<div class="vehicule" onclick="location.reload();" style="background-color:#eef52a;top:85vh;left:20vw;padding:5px;position:absolute;height:5vh;font-size:5vh;color:black;border: solid 1px black;"><b>RECOMMENCER</b></div>


		</div>


	</body>
	
	<script>
	
		var score = 0;
		
		var explosion = new Audio('assets/sounds/explosion.wav');
		var failure = new Audio('assets/sounds/failure.wav');
		var carstart = new Audio('assets/sounds/carstart.wav');
		var jump1 = new Audio('assets/sounds/jump1.wav');
		var jump2 = new Audio('assets/sounds/jump2.wav');


		carstart.pause();
		carstart.currentTime = 0;
		carstart.play();




	</script>

</html>