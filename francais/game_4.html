<html lang="fr" xml:lang="fr" xmlns="http://www.w3.org/1999/xhtml">

<!--

Copyrights : Francis B. Lavoie et Adam Renquinha. TOUS DROITS RÉSERVÉS

-->

	<head>
		<meta charset="UTF-8">
		<script
		  src="https://code.jquery.com/jquery-3.6.0.min.js"
		  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
		  crossorigin="anonymous"></script>
		 <script
		  src="https://code.jquery.com/ui/1.13.1/jquery-ui.min.js"
		  integrity="sha256-eTyxS0rkjpLEo16uXTS0uVCS4815lc40K2iVpWDvdSY="
		  crossorigin="anonymous"></script>
		  <link rel="preconnect" href="https://fonts.googleapis.com">
		  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
		  
		  <style>
		  
			body{
				background: url("assets/img/decor.png");
				background-repeat: no-repeat;
				background-size: 100vw 100vh;
			}

			.vehicule {
				cursor:pointer;
			}

			div{
				user-drag:none;
				user-select:none;
				-moz-user-select:none;
				-webkit-user-drag:none;
				-websit-user-select:none;
				-ms-user-select:none;
			}

			img{
				user-drag:none;
				user-select:none;
				-moz-user-select:none;
				-webkit-user-drag:none;
				-websit-user-select:none;
				-ms-user-select:none;
			}
			
			
			.interruption{
				filter: brightness(50%);
			}
			
			.logo:hover{
				cursor:pointer;
			}
			
			
			.tile{
				position:absolute;
				width:23.5vw;
				height:auto;
				border: solid 0.5vw rgb(90,90,90)
			}

			.x_0{
				position:absolute;
				left:2vw;
			}
			.x_1{
				position:absolute;
				left:26vw;
			}
			.x_2{
				position:absolute;
				left:50vw;
			}
			.x_3{
				position:absolute;
				left:74vw;
			}
			
			.y_0{
				position:absolute;
				top:20vw;
			}
		  
            .y_1{
				position:absolute;
				top:44vw;
			}
		  
            .y_2{
				position:absolute;
				top:68vw;
			}
		  
            .y_3{
				position:absolute;
				top:92vw;
			}
			
			
			.horizontal{
				
			}
		  	
			.vertical{
				transform:rotate(90deg);
			}
			
			.main_top{
				
			}
			
			.main_right{
				transform:rotate(90deg);
			}
			
			.main_bottom{
				transform:rotate(180deg);
			}
			
			.main_left{
				transform:rotate(270deg);
			}
			
			.angle_reverse_hor{
			  -webkit-transform: scaleX(-1);
			  transform: scaleX(-1);

			}
			
			.angle_reverse_ver{
			  -webkit-transform: scaleY(-1);
			  transform: scaleY(-1);

			}
			
			.angle_reverse_right{
			  transform:rotate(90deg);
			 -webkit-transform: scaleY(-1);
			  transform: scaleY(-1);
			}
			
		  
		  </style>
	</head>
	
	<body id="bodygame" scroll="no" style="  overflow: hidden; width:100%;">
	

	
		<div id="princ_container" style="position:absolute;top:0;left:0;width:100%;height: 100%;">

			<img src="assets/img/avtlogo.PNG" style="position:absolute;top:93vh;height:5vh;left:80vw;width:auto;">

			<div style="position:absolute;width:100vw;height:20vw;background-color:rgb(0, 186, 56)">
			</div>
			<div style="position:absolute;top:20vw;width:100vw;height:96vw;background-color:rgb(21, 96, 130)">
			</div>
			<div style="position:absolute;top:116vw;width:100vw;height:200vw;background-color:rgb(0, 186, 56)">
			</div>

			<div id="tous_les_panneaux" style="z-index:10">
				<img src="assets/img/tile_straight.png" id="t_0_0" onclick="ct(0,0)" class="tile x_0 y_0" >
				<img src="assets/img/tile_angle.png" id="t_1_0"    onclick="ct(1,0)" class="tile x_1 y_0" >
				<img src="assets/img/tile_straight.png" id="t_2_0" onclick="ct(2,0)" class="tile x_2 y_0" >
				<img src="assets/img/tile_straight.png" id="t_3_0" onclick="ct(3,0)" class="tile x_3 y_0" >
				<img src="assets/img/tile_angle.png" id="t_0_1"    onclick="ct(0,1)" class="tile x_0 y_1"  >
				<img src="assets/img/tile_straight.png" id="t_1_1" onclick="ct(1,1)" class="tile x_1 y_1" >
				<img src="assets/img/tile_straight.png" id="t_2_1" onclick="ct(2,1)" class="tile x_2 y_1" >
				<img src="assets/img/tile_straight.png" id="t_3_1" onclick="ct(3,1)" class="tile x_3 y_1" >
				<img src="assets/img/tile_straight.png" id="t_0_2" onclick="ct(0,2)" class="tile x_0 y_2" >
				<img src="assets/img/tile_straight.png" id="t_1_2" onclick="ct(1,2)" class="tile x_1 y_2" >
				<img src="assets/img/tile_straight.png" id="t_2_2" onclick="ct(2,2)" class="tile x_2 y_2" >
				<img src="assets/img/tile_straight.png" id="t_3_2" onclick="ct(3,2)" class="tile x_3 y_2" >
				<img src="assets/img/tile_straight.png" id="t_0_3" onclick="ct(0,3)" class="tile x_0 y_3" >
				<img src="assets/img/tile_straight.png" id="t_1_3" onclick="ct(1,3)" class="tile x_1 y_3" >
				<img src="assets/img/tile_straight.png" id="t_2_3" onclick="ct(2,3)" class="tile x_2 y_3" >
				<img src="assets/img/tile_straight.png" id="t_3_3" onclick="ct(3,3)" class="tile x_3 y_3" >
			</div>
			
			
			
			<div style="position:absolute;top:90vh;left:2vw;font-size:2.3vh;width:70vw;" id="bottom_message" >
				Appuie sur les tuiles afin de créer un tracé entre Québec et Lévis, soit du haut de l'écran vers le bas.
			</div>
			
				
			
			<script>
			
				all_sols = [
				
					[[3,0,[0,1]],[3,1,[0,1]],[3,2,[0,1]],[3,3,[0,1]]],
					[[3,0,[0,1]],[3,1,[1,1]],[2,1,[3,1]],[2,2,[0,1]],[2,3,[1,0]],[3,3,[4,1]]],
					[[2,0,[0,1]],[2,1,[0,1]],[2,2,[0,1]],[2,3,[1,1]],[3,3,[2,0]]],
    				[[3,0,[1,1]],[2,0,[3,1]],[2,1,[1,1]],[1,1,[3,1]],[1,2,[0,1]],[1,3,[0,1]]],
					[[3,0,[1,1]],[2,0,[2,0]],[2,1,[0,1]],[2,2,[4,0]],[1,2,[2,0]],[1,3,[1,1]],[0,3,[3,1]]],
					[[0,0,[2,1]],[1,0,[0,0]],[2,0,[0,0]],[3,0,[4,1]],[3,1,[4,0]],[2,1,[0,0]],[1,1,[2,0]],[1,2,[0,1]],[1,3,[1,1]],[0,3,[3,1]]],
					[[2,0,[4,0]],[1,0,[3,1]],[1,1,[2,1]],[2,1,[0,0]],[3,1,[4,1]],[3,2,[4,0]],[2,2,[3,1]],[2,3,[2,1]],[3,3,[3,0]]],
					[[3,0,[4,0]],[2,0,[2,0]],[2,1,[0,1]],[2,2,[0,1]],[2,3,[1,1]],[1,3,[3,1]]],
					[[1,0,[1,0]],[2,0,[4,1]],[2,1,[2,1]],[3,1,[4,1]],[3,2,[4,0]],[2,2,[3,1]],[2,3,[0,1]]],
					[[0,0,[0,1]],[0,1,[0,1]],[0,2,[2,1]],[1,2,[0,0]],[2,2,[4,1]],[2,3,[0,1]]],
					[[1,0,[1,1]],[0,0,[3,1]],[0,1,[1,0]],[1,1,[0,0]],[2,1,[0,0]],[3,1,[3,0]],[3,2,[4,0]],[2,2,[3,1]],[2,3,[0,1]]],
					[[1,0,[0,1]],[1,1,[0,1]],[1,2,[1,0]],[2,2,[4,1]],[2,3,[2,1]],[3,3,[4,1]]],
					[[0,0,[0,1]],[0,1,[0,1]],[0,2,[1,0]],[1,2,[1,1]],[1,1,[3,1]],[2,1,[3,0]],[2,2,[0,1]],[2,3,[0,1]]]
				]

			
			
			
			
			
				function getRandomInt(min, max) {
					min = Math.ceil(min);
					max = Math.floor(max);
					return Math.floor(Math.random() * (max - min + 1)) + min;
				}
			
				
				nb_sol =  getRandomInt(0, all_sols.length-1)
				
				
				
				// Create map
				var map = [[[2,0],[3,1],[0,1],[3,1]],[[2,1],[3,1],[0,0],[0,0]],[[3,1],[1,0],[3,1],[3,1]],[[1,0],[2,1],[0,1],[1,0]]]

				
				random_map = true
				
				if(random_map){
					map = []
				}
				
				
				function modify_init(x,y,sel,state){
					$("#t_"+x+"_"+y).removeClass("horizontal")
					$("#t_"+x+"_"+y).removeClass("vertical")
					$("#t_"+x+"_"+y).removeClass("main_top")
					$("#t_"+x+"_"+y).removeClass("main_right")
					$("#t_"+x+"_"+y).removeClass("main_bottom")
					$("#t_"+x+"_"+y).removeClass("main_left")
					$("#t_"+x+"_"+y).removeClass("angle_reverse_hor")
					$("#t_"+x+"_"+y).removeClass("angle_reverse_ver")

					if(sel == 0){
						$("#t_"+x+"_"+y).attr("src","assets/img/tile_straight.png")
						if(state == 0){
							$("#t_"+x+"_"+y).addClass("horizontal")
						}
						else{
							$("#t_"+x+"_"+y).addClass("vertical")
						}
					}
					else{
						$("#t_"+x+"_"+y).attr("src","assets/img/tile_angle.png")
						if(sel == 1){
							$("#t_"+x+"_"+y).addClass("main_top")
							if(state == 1){
								$("#t_"+x+"_"+y).addClass("angle_reverse_hor")
							}
						}
						else if(sel == 2){
							$("#t_"+x+"_"+y).addClass("main_right")
							if(state == 1){
								$("#t_"+x+"_"+y).attr("src","assets/img/tile_angle_flip.png")
							}
						}
						else if(sel == 3){
							$("#t_"+x+"_"+y).addClass("main_bottom")
							if(state == 1){
								$("#t_"+x+"_"+y).addClass("angle_reverse_ver")
							}
						}
						else if(sel == 4){
							$("#t_"+x+"_"+y).addClass("main_left")
							if(state == 1){
								$("#t_"+x+"_"+y).attr("src","assets/img/tile_angle_flip.png")
							}
						}
					}
				}
				
				
				
				
				
				
				choices = [0,0,1,2,3,4]
				for(x=0;x<4;x++){
					row = []
				
					for(y=0;y<4;y++){
						
						if(random_map){
							sel = choices[getRandomInt(0,5)]
							state = getRandomInt(0,1)
						}
						else{
							sel = map[x][y][0]
							state = map[x][y][1]
						}
						
						modify_init(x,y,sel,state)
						console.log(x,y,sel,state)
						
						row.push([sel,state])
					}
					
					if(random_map){
						map.push(row);
					}
				}
				
				

				sol = all_sols[nb_sol]
				console.log("sol",sol)
				for(i=0;i<sol.length;i++){
					sel = sol[i]
					x = sel[0]
					y = sel[1]
					a = sel[2][0]
					state = sel[2][1]
					modify_init(x,y,a,Math.abs(state-1))
					map[x][y] = [a,state]
					ct(x,y)
				}
				
				

				
				
				function ct(x,y){
					info = map[x][y]
					tile = info[0]
					state = info[1]
					
					new_state = Math.abs(state-1)
					map[x][y][1] = new_state;
					console.log(x,y,map[x][y])
					
					if(tile == 0){
						if(new_state == 0){
							$("#t_"+x+"_"+y).addClass("horizontal")
							$("#t_"+x+"_"+y).removeClass("vertical")
						}
						if(new_state == 1){
							$("#t_"+x+"_"+y).removeClass("horizontal")
							$("#t_"+x+"_"+y).addClass("vertical")
						}
					}
					else if( (tile == 1) ){
						if(new_state == 0){
							$("#t_"+x+"_"+y).removeClass("angle_reverse_hor")
						}
						if(new_state == 1){
							$("#t_"+x+"_"+y).addClass("angle_reverse_hor")
						}
					}
					else if( (tile == 3)  ){
						if(new_state == 0){
							$("#t_"+x+"_"+y).removeClass("angle_reverse_ver")
						}
						if(new_state == 1){
							$("#t_"+x+"_"+y).addClass("angle_reverse_ver")
						}
					}
					else{
						if(new_state == 0){
							$("#t_"+x+"_"+y).attr("src","assets/img/tile_angle.png")
						}
						if(new_state == 1){
							$("#t_"+x+"_"+y).attr("src","assets/img/tile_angle_flip.png")
						}
					}
					
					setTimeout(function()
					{
						check_winning()
					},100);
				}

				console.log(JSON.stringify(map))
				
				
				function joins(x,y){
					
					
					info = map[x][y]
					tile = info[0]
					state = info[1]
					
					
					
					if( tile == 0 ){ // Straight
						if(state == 0){
							dir1 = [-1,0]
							dir2 = [1,0]
						}
						else if(state == 1){
							dir1 = [0,-1]
							dir2 = [0,1]
						}
					}
					else if( tile == 1 ){ // Common top
						if(state == 0){
							dir1 = [0,-1]
							dir2 = [1,0]
						}
						else if(state == 1){
							dir1 = [0,-1]
							dir2 = [-1,0]
						}
					}
					else if( tile == 2 ){ // Common right
						if(state == 0){
							dir1 = [1,0]
							dir2 = [0,1]
						}
						else if(state == 1){
							dir1 = [1,0]
							dir2 = [0,-1]
						}
					}
					else if( tile == 3 ){ // Common bottom
						console.log("tile 3")
						if(state == 0){
							dir1 = [0,1]
							dir2 = [-1,0]
						}
						else if(state == 1){
							dir1 = [0,1]
							dir2 = [1,0]
						}
					}
					else if( tile == 4 ){ // Common left
						if(state == 0){
							dir1 = [-1,0]
							dir2 = [0,-1]
						}
						else if(state == 1){
							dir1 = [-1,0]
							dir2 = [0,1]
						}
					}
					
					return [dir1, dir2]
				}
				
				
				
				
				function check_winning(){
					
					mods_y = [[0,1],[0,-1]]
					mods_x = [[1,0],[-1,0]]
					
					success = false;
				
					possibilities = []
					for(x=0;x<4;x++){ // 4 places to begin
						
						console.log("beginning ",x)
						
						// Initialize position and direction
						current_pos = [x,-1]
						direction = [0,1]
					
						not_blocked = true
						trial = 0;
						
						path = []
						while(  (trial < 15) && (success==false) ){
						
							// Try 4 modifications
							no_change = true
							for(p=0;p<=0;p++){
								
								if(Math.abs(direction[0])==1){
									if(direction[0] == -1){
										mods = [[-1,0]]
									}
									else{
										mods = [[1,0]]
									}
								}
								else{
									if(direction[1] == -1){
										mods = [[0,-1]]
									}
									else{
										mods = [[0,1]]
									}
								}
								
								if(no_change){
									new_pos = [current_pos[0]+mods[p][0], current_pos[1]+mods[p][1]]
									if( (new_pos[0]>=0) && (new_pos[0]<=3) && (new_pos[1]>=0) && (new_pos[1]<=3) ){
										directions = joins(new_pos[0],new_pos[1])
										if(no_change){
											if( ( directions[0][0]*-1 == direction[0] ) && ( directions[0][1]*-1== direction[1] ) ){
												current_pos = [new_pos[0],new_pos[1]]
												path.push([new_pos[0],new_pos[1],map[new_pos[0]][new_pos[1]]])
												direction = directions[1]
												no_change = false
												console.log("pass",mods[p],"new_pos",new_pos,"direction",direction)
											}
											else if( ( directions[1][0]*-1== direction[0] ) && ( directions[1][1]*-1== direction[1] ) ){
												current_pos = [new_pos[0],new_pos[1]]
												path.push([new_pos[0],new_pos[1],map[new_pos[0]][new_pos[1]]])
												direction = directions[0]
												no_change = false
												console.log("pass",mods[p],"new_pos",new_pos,"direction",direction)
											}
										}
									}
									
									if(current_pos[1]==3){
										if(direction[1]==1){
											success = true
										}
									}
								}
							}
							
							trial = trial + 1
						}
						
						if(success){
							console.log("path",JSON.stringify(path))
						}
					
					}
					
					if(success){
						console.log("success")
					}
					else{
						console.log("no win")
					}
					
				}
				

			</script>
			
		</div>

		<div id="final_container" style="position:absolute;left:0;top:0;width:100%;height:100%;background-color:rgb(240,240,240);z-index:999;display:none;">
			
			 <div id="end_image" style="position:absolute;top:15vh;left:40vw;width:20vw;height:20vw;text-align:left;height:auto;color:black;font-size:3.2vh;font-family: Arial, Helvetica, sans-serif;">
				<img style="width:100%;height:100%" src="assets/img/nobus2.png">
			 </div>
			
			 <div id="end_text" style="position:absolute;top:30vh;left:5vw;width:90vw;text-align:left;height:auto;color:black;font-size:3.2vh;font-family: Arial, Helvetica, sans-serif;text-align:center;">
				Tu aurais pu faire mieux. Remplacer les 5 panneaux de transport en commun t'a pris beaucoup de temps, soit exactement <b><span style="color:red;" id="nb_seconds"></span></b> secondes. J'espère que tu feras mieux la prochaine fois.
			</div>

			<img src="assets/img/genevieve1.png" style="position:fixed;top:60vh;left:0vw;height:auto;width:100vw;">

			<div  onclick="location.reload();" class="vehicule" style="background-color:#eef52a;top:0vh;left:0vw;padding:5px;position:absolute;width:100%;height:5vh;font-size:5vh;color:black;border: solid 1px black;font-family: Arial, Helvetica, sans-serif;text-align:center;" ><b>RECOMMENCER</b></div>



		</div>


	</body>
	
	<script>
	
		var score = 0;
		
		var trumpet = new Audio('assets/sounds/trumpet.wav');
		var success = new Audio('assets/sounds/success2.mp3');
		var wrong = new Audio('assets/sounds/wrong.wav');
		var endings = new Audio('assets/sounds/ending.mp3');






		var beginning = 3000;
		var temps_ecoule = 0;
		var started = false;
		var found = 0;
		
		setInterval(function () {
		
			if(beginning>0){
				beginning = beginning -20
				$("#beginning").html(Math.ceil(beginning/1000));
			}
			else if(beginning == 0){
				beginning = beginning - 20;
				$("#beginning").hide();
				started = true;
				trumpet.pause();
				trumpet.currentTime = 0;
				trumpet.play();
			}
			else if(started){
				temps_ecoule = temps_ecoule+20;
			}
			
			
		}, 20);



	</script>

</html>